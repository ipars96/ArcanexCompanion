<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #071013;
            color: #071013;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            max-width: 1200px;
            width: 100%;
            margin-top: 20px;
            display: flex;
            gap: 20px;
        }
        .left-column, .right-column {
            background-color: #DFE0E2;
            padding: 20px;
            border-radius: 15px;
            flex: 1;
            position: relative;
        }
        .inventory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .inventory-item {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 10px;
            position: relative;
            flex-wrap: nowrap;
            padding-right: 15px;
        }
        .inventory-item input {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #AAAAAA;
        }
        .inventory-item input[name="itemQuantity"] {
            width: 35px;
            flex-shrink: 0;
        }
        .inventory-item input[name="itemName"] {
            flex: 2;
            min-width: 35%;
        }
        .inventory-item select[name="itemType"] {
            flex: 1.5;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #AAAAAA;
            background-color: white;
            color: #071013;
            font-family: inherit;
        }
        .inventory-item input[name="itemValue"] {
            width: 60px;
            flex-shrink: 0;
        }
        .info-button, .delete-button {
            background-color: #AAAAAA;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            width: 35px;
        }
        .info-button {
            background-color: #AAAAAA;
            margin-right: 5px;
        }
        .delete-button {
            background-color: #EB5160;
            margin-left: auto;
        }
        .add-item {
            background-color: #EB5160;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        .unlock-button {
            background-color: white;
            color: #071013;
            border: 2px solid #AAAAAA;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            text-align: center;
            display: none;
        }
        .revert-item {
            background-color: white;
            color: #071013;
            border: 2px solid #AAAAAA;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            text-align: center;
            display: none;
        }
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .popup {
            background-color: #DFE0E2;
            padding: 20px;
            border-radius: 10px;
            width: 400px;
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 1001;
        }
        .popup .action-buttons {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 20px;
        }
        .popup .save-button, .popup .close-button, .popup .unlock-button, .popup .revert-button {
            background-color: white;
            color: #071013;
            border: 2px solid #AAAAAA;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
            width: 48%;
        }
        .popup .close-button, .popup .revert-button {
            background-color: #EB5160;
            color: white;
        }
        .delete-confirmation {
            text-align: center;
            z-index: 1002;
        }
        .delete-confirmation button {
            padding: 10px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .confirm-button {
            background-color: #EB5160;
            color: white;
        }
        .cancel-button {
            background-color: #AAAAAA;
            color: white;
        }
        .person-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }
        .person-square {
            width: 40px;
            height: 40px;
            background-color: #071013;
            margin: 5px;
            border-radius: 5px;
        }
        .gear-box {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .gear-box label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .gear-box input {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #AAAAAA;
            width: calc(100% - 20px);
        }
        .tooltip {
            position: absolute;
            background-color: #DFE0E2;
            color: #071013;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 1001;
        }
        .category-divider {
            border-bottom: 1px solid #AAAAAA;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div id="navbar"></div> <!-- Placeholder for the navigation bar -->

    <div class="container">
        <!-- Left Column: Inventory Items -->
        <div class="left-column">
            <div class="inventory-header">
                <h2>Inventory</h2>
                <div id="inventoryCounter">0/25</div>
            </div>
            <button class="add-item" id="addItemButton" onclick="addItem()">+ Add Item</button>
            <button id="unlockButton" class="unlock-button" onclick="showUnlockPopup()" style="display: none;">Unlock More Inventory</button>
            <!-- Default section for items without a category -->
            <div id="defaultCategory"></div>
            <!-- Categories -->
            <div class="category-divider"></div>
            <h3>Consumables</h3>
            <div id="consumablesCategory"></div>
            <div class="category-divider"></div>
            <h3>Crafting</h3>
            <div id="craftingCategory"></div>
            <div class="category-divider"></div>
            <h3>Equipment</h3>
            <div id="equipmentCategory"></div>
            <div class="category-divider"></div>
            <h3>Loot</h3>
            <div id="lootCategory"></div>
            <div class="category-divider"></div>
            <h3>Notes</h3>
            <div id="notesCategory"></div>
            <div class="category-divider"></div>
            <h3>Quest Items</h3>
            <div id="questItemsCategory"></div>
            <div class="category-divider"></div>
            <h3>Weapons</h3>
            <div id="weaponsCategory"></div>
            <div class="category-divider"></div>

            <!-- Revert Inventory Button -->
            <button id="revertItemButton" class="revert-item" onclick="showRevertPopup()">Revert Inventory</button>
        </div>

        <!-- Right Column: Character Icon and Gear -->
        <div class="right-column">
            <div class="person-icon">
                <div class="person-square"></div> <!-- Head -->
                <div class="person-square"></div> <!-- Body -->
                <div class="person-square"></div> <!-- Legs -->
                <div class="person-square"></div> <!-- Feet -->
            </div>
            <div class="gear-box">
                <label for="armor">Armor</label>
                <input type="text" id="armor" name="armor">
                <label for="head">Head</label>
                <input type="text" id="head" name="head">
                <label for="hands">Hands</label>
                <input type="text" id="hands" name="hands">
                <label for="feet">Feet</label>
                <input type="text" id="feet" name="feet">
            </div>
        </div>
    </div>

    <!-- Tooltip Element -->
    <div id="tooltip" class="tooltip"></div>

    <!-- Unlock Inventory Popup -->
    <div class="popup-overlay" id="unlockPopup">
        <div class="popup">
            <p id="unlockMessage">Inventory Full. Upgrade inventory capacity by acquiring the Pack Mule skill.</p>
            <div class="action-buttons">
                <button class="close-button" onclick="closePopup('unlockPopup')">Close</button>
                <button class="save-button" onclick="handleUnlockInventory()">I have acquired the skill</button>
            </div>
        </div>
    </div>

    <!-- Revert Inventory Popup -->
    <div class="popup-overlay" id="revertPopup">
        <div class="popup">
            <p id="revertMessage">Revert inventory capacity to previous tier?</p>
            <div class="action-buttons">
                <button class="close-button" onclick="closePopup('revertPopup')">Close</button>
                <button class="revert-button" onclick="revertInventory()">Revert</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Popup -->
    <div class="popup-overlay" id="deleteConfirmation">
        <div class="popup delete-confirmation">
            <p id="deleteConfirmationText">Are you sure you want to delete this item?</p>
            <button class="confirm-button" onclick="confirmDeleteItem()">Delete</button> <!-- Changed button text to "Delete" -->
            <button class="cancel-button" onclick="closePopup('deleteConfirmation')">Cancel</button>
        </div>
    </div>

    <!-- Info Popup -->
    <div class="popup-overlay" id="infoPopup">
        <div class="popup">
            <div class="popup-header">
                <div class="image-container">
                    <img src="https://via.placeholder.com/100" alt="Item Image" id="itemImage">
                    <input type="file" id="uploadImage" style="display: none;">
                </div>
                <div class="details">
                    <label for="popupItemName">Name</label>
                    <input type="text" id="popupItemName" placeholder="Item Name">
                    <label for="popupItemType">Type</label>
                    <select id="popupItemType" onchange="moveItemToCategory(this)">
                        <option value="">Select Type</option>
                        <option value="Consumable">Consumable</option>
                        <option value="Weapon">Weapon</option>
                        <option value="Equipment">Equipment</option>
                        <option value="Crafting">Crafting</option>
                        <option value="Loot">Loot</option>
                        <option value="Notes">Notes</option>
                        <option value="Quest Items">Quest Items</option>
                    </select>
                    <div class="side-by-side">
                        <div class="value-container">
                            <label for="popupItemValue">Value</label>
                            <input type="number" id="popupItemValue" placeholder="Value">
                        </div>
                        <div class="quantity-container">
                            <label for="popupItemQuantity">Quantity</label>
                            <input type="number" id="popupItemQuantity" placeholder="Quantity">
                        </div>
                    </div>
                </div>
            </div>
            <label for="popupItemDescription">Description</label>
            <textarea id="popupItemDescription" class="description" placeholder="Description"></textarea>
            <div class="action-buttons">
                <button class="save-button" onclick="saveItem()">Save</button>
                <button class="close-button" onclick="closePopup('infoPopup')">Close</button>
            </div>
        </div>
    </div>

    <script>
        let inventoryLimit = 25; // Starting inventory limit
        let currentInventoryCount = 0;
        let currentItemEditing = null;
        let itemToDelete = null;

        function updateInventoryCounter() {
            document.getElementById('inventoryCounter').textContent = `${currentInventoryCount}/${inventoryLimit}`;
            const addItemButton = document.getElementById('addItemButton');
            const unlockButton = document.getElementById('unlockButton');

            if (currentInventoryCount >= inventoryLimit) {
                addItemButton.style.display = 'none';
                unlockButton.style.display = 'block';
            } else {
                addItemButton.style.display = 'block';
                unlockButton.style.display = 'none';
            }
        }

        function addItem() {
            if (currentInventoryCount >= inventoryLimit) {
                showUnlockButton();
                return;
            }

            const newItem = document.createElement('div');
            newItem.classList.add('inventory-item');
            newItem.innerHTML = `
                <input type="number" name="itemQuantity" value="1" placeholder="Quantity">
                <input type="text" name="itemName" placeholder="Item Name">
                <select name="itemType" onchange="moveItemToCategory(this)">
                    <option value="">Select Type</option>
                    <option value="Consumable">Consumable</option>
                    <option value="Weapon">Weapon</option>
                    <option value="Equipment">Equipment</option>
                    <option value="Crafting">Crafting</option>
                    <option value="Loot">Loot</option>
                    <option value="Notes">Notes</option>
                    <option value="Quest Items">Quest Items</option>
                </select>
                <input type="number" name="itemValue" placeholder="Value">
                <button class="info-button" onclick="showInfoPopup(this)">Info</button>
                <button class="delete-button" onclick="showDeleteConfirmation(this)">🗑️</button>
            `;

            // Place the new item in the defaultCategory section initially
            const defaultCategory = document.getElementById('defaultCategory');
            defaultCategory.appendChild(newItem);

            currentInventoryCount++;
            updateInventoryCounter();
        }

        function moveItemToCategory(selectElement) {
            const item = selectElement.closest('.inventory-item');
            const itemType = selectElement.value;

            const defaultCategory = document.getElementById('defaultCategory');
            const categories = {
                'Consumable': document.getElementById('consumablesCategory'),
                'Weapon': document.getElementById('weaponsCategory'),
                'Equipment': document.getElementById('equipmentCategory'),
                'Crafting': document.getElementById('craftingCategory'),
                'Loot': document.getElementById('lootCategory'),
                'Notes': document.getElementById('notesCategory'),
                'Quest Items': document.getElementById('questItemsCategory'),
                '': defaultCategory
            };

            // Move the item to the appropriate category section
            const targetCategory = categories[itemType] || defaultCategory;
            targetCategory.appendChild(item);

            // Sort items alphabetically within the target category
            sortCategoryItemsAlphabetically(targetCategory);
        }

        function sortCategoryItemsAlphabetically(categoryElement) {
            const items = Array.from(categoryElement.getElementsByClassName('inventory-item'));
            items.sort((a, b) => {
                const nameA = a.querySelector('input[name="itemName"]').value.toLowerCase();
                const nameB = b.querySelector('input[name="itemName"]').value.toLowerCase();
                return nameA.localeCompare(nameB);
            });

            // Re-append sorted items to the category element
            items.forEach(item => categoryElement.appendChild(item));
        }

        function showDeleteConfirmation(button) {
            itemToDelete = button.closest('.inventory-item');
            const itemName = itemToDelete.querySelector('input[name="itemName"]').value;

            const deleteConfirmationText = document.getElementById('deleteConfirmationText');
            deleteConfirmationText.textContent = `Are you sure you want to delete ${itemName}?`;

            const deleteConfirmation = document.getElementById('deleteConfirmation');
            deleteConfirmation.style.display = 'flex';
        }

        function confirmDeleteItem() {
            if (itemToDelete) {
                itemToDelete.remove();
                currentInventoryCount--;
                updateInventoryCounter();
            }
            closePopup('deleteConfirmation'); // Close the popup after deletion
        }

        function showInfoPopup(button) {
            currentItemEditing = button.closest('.inventory-item');

            const itemName = currentItemEditing.querySelector('input[name="itemName"]').value;
            const itemType = currentItemEditing.querySelector('select[name="itemType"]').value;
            const itemValue = currentItemEditing.querySelector('input[name="itemValue"]').value;
            const itemQuantity = currentItemEditing.querySelector('input[name="itemQuantity"]').value;

            document.getElementById('popupItemName').value = itemName;
            document.getElementById('popupItemType').value = itemType;
            document.getElementById('popupItemValue').value = itemValue;
            document.getElementById('popupItemQuantity').value = itemQuantity;

            const infoPopup = document.getElementById('infoPopup');
            infoPopup.style.display = 'flex';
        }

        function saveItem() {
            if (currentItemEditing) {
                const itemName = document.getElementById('popupItemName').value;
                const itemType = document.getElementById('popupItemType').value;
                const itemValue = document.getElementById('popupItemValue').value;
                const itemQuantity = document.getElementById('popupItemQuantity').value;

                currentItemEditing.querySelector('input[name="itemName"]').value = itemName;
                currentItemEditing.querySelector('select[name="itemType"]').value = itemType;
                currentItemEditing.querySelector('input[name="itemValue"]').value = itemValue;
                currentItemEditing.querySelector('input[name="itemQuantity"]').value = itemQuantity;

                closePopup('infoPopup');

                // Move the edited item to the correct category
                moveItemToCategory(currentItemEditing.querySelector('select[name="itemType"]'));
            }
        }

        function closePopup(popupId) {
            const popup = document.getElementById(popupId);
            popup.style.display = 'none';
        }

        function showUnlockPopup() {
            const packMuleLevel = inventoryLimit / 25;
            const unlockMessage = document.getElementById('unlockMessage');
            
            let packMuleText;
            switch (inventoryLimit) {
                case 25:
                    packMuleText = "Pack Mule";
                    break;
                case 50:
                    packMuleText = "Pack Mule II";
                    break;
                case 75:
                    packMuleText = "Pack Mule III";
                    break;
                case 100:
                    packMuleText = "Pack Mule IV";
                    break;
                default:
                    packMuleText = "Pack Mule";
                    break;
            }

            unlockMessage.textContent = `Inventory Full. Upgrade inventory capacity by acquiring the ${packMuleText} skill.`;

            const unlockPopup = document.getElementById('unlockPopup');
            unlockPopup.style.display = 'flex';
        }

        function handleUnlockInventory() {
            inventoryLimit += 25;
            updateInventoryCounter();
            closePopup('unlockPopup');

            const addItemButton = document.getElementById('addItemButton');
            const unlockButton = document.getElementById('unlockButton');

            if (currentInventoryCount < inventoryLimit) {
                addItemButton.style.display = 'block';
                unlockButton.style.display = 'none';
            }

            if (inventoryLimit > 25) {
                document.getElementById('revertItemButton').style.display = 'block';
            }

            const packMuleLevel = inventoryLimit / 25;
            const nextPackMuleLevel = packMuleLevel + 1;
            const unlockMessage = document.getElementById('unlockMessage');
            
            let packMuleText;
            switch (inventoryLimit) {
                case 50:
                    packMuleText = "Pack Mule II";
                    break;
                case 75:
                    packMuleText = "Pack Mule III";
                    break;
                case 100:
                    packMuleText = "Pack Mule IV";
                    break;
                case 150:
                    packMuleText = "No Further Upgrades";
                    break;
                default:
                    packMuleText = "Pack Mule";
                    break;
            }

            unlockMessage.textContent = `Inventory Full. Upgrade inventory capacity by acquiring the ${packMuleText} skill.`;
        }

        function showRevertPopup() {
            if (inventoryLimit > 25) {
                document.getElementById('revertPopup').style.display = 'flex';
            }
        }

        function revertInventory() {
            if (currentInventoryCount > inventoryLimit - 25) {
                alert(`You must reduce inventory count to ${inventoryLimit - 25} before reverting back a tier.`);
                return;
            }

            inventoryLimit -= 25;
            updateInventoryCounter();
            closePopup('revertPopup');

            if (inventoryLimit <= 25) {
                document.getElementById('revertItemButton').style.display = 'none';
            }

            const packMuleLevel = inventoryLimit / 25;
            const unlockMessage = document.getElementById('unlockMessage');
            
            let packMuleText;
            switch (inventoryLimit) {
                case 25:
                    packMuleText = "Pack Mule";
                    break;
                case 50:
                    packMuleText = "Pack Mule II";
                    break;
                case 75:
                    packMuleText = "Pack Mule III";
                    break;
                case 100:
                    packMuleText = "Pack Mule IV";
                    break;
                default:
                    packMuleText = "Pack Mule";
                    break;
            }

            unlockMessage.textContent = `Inventory Full. Upgrade inventory capacity by acquiring the ${packMuleText} skill.`;
        }

        fetch('nav.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('navbar').innerHTML = data;
            });
    </script>
</body>
</html>
