<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #071013;
            color: #071013;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            max-width: 1200px;
            width: 100%;
            margin-top: 20px;
            display: flex;
            gap: 20px;
        }
        .left-column, .right-column {
            background-color: #DFE0E2;
            padding: 20px;
            border-radius: 15px;
            flex: 1;
            position: relative;
        }
        .inventory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .inventory-item {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 10px;
            position: relative;
            flex-wrap: nowrap;
            padding-right: 15px; /* Ensure consistent padding on the right */
        }
        .inventory-item input {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #AAAAAA;
        }
        .inventory-item input[name="itemQuantity"] {
            width: 35px; /* Reduced size of quantity field */
            flex-shrink: 0; /* Prevents shrinking */
        }
        .inventory-item input[name="itemName"] {
            flex: 2;
            min-width: 35%;
        }
        .inventory-item select[name="itemType"] {
            flex: 1.5; /* Increased width for itemType field */
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #AAAAAA;
            background-color: white;
            color: #071013;
            font-family: inherit;
        }
        .inventory-item input[name="itemValue"] {
            width: 60px; /* Adjusted width for value field */
            flex-shrink: 0; /* Prevents shrinking */
        }
        .info-button, .delete-button {
            background-color: #AAAAAA;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            width: 35px;
        }
        .info-button {
            background-color: #AAAAAA;
            margin-right: 5px;
        }
        .delete-button {
            background-color: #EB5160;
            margin-left: auto; /* Align the delete button to the far right */
        }
        .add-item {
            background-color: #EB5160;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        .revert-item {
            background-color: white;
            color: #071013;
            border: 2px solid #AAAAAA;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            text-align: center;
            display: none; /* Initially hidden */
        }
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .popup {
            background-color: #DFE0E2;
            padding: 20px;
            border-radius: 10px;
            width: 400px;
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 1001; /* Ensure pop-up stays on top */
        }
        .popup .action-buttons {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 20px;
        }
        .popup .save-button, .popup .close-button, .popup .unlock-button, .popup .revert-button {
            background-color: white;
            color: #071013;
            border: 2px solid #AAAAAA;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
            width: 48%;
        }
        .popup .close-button, .popup .revert-button {
            background-color: #EB5160;
            color: white;
        }
        .delete-confirmation {
            text-align: center;
            z-index: 1002; /* Ensure delete confirmation is on top */
        }
        .delete-confirmation button {
            padding: 10px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .confirm-button {
            background-color: #EB5160;
            color: white;
        }
        .cancel-button {
            background-color: #AAAAAA;
            color: white;
        }
        .person-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }
        .person-square {
            width: 40px;
            height: 40px;
            background-color: #071013;
            margin: 5px;
            border-radius: 5px;
        }
        .gear-box {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .gear-box label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .gear-box input {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #AAAAAA;
            width: calc(100% - 20px);
        }

        /* Tooltip Styles */
        .tooltip {
            position: absolute;
            background-color: #DFE0E2;
            color: #071013;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 1001;
        }
        .category-divider {
            border-top: 2px solid #AAAAAA;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div id="navbar"></div> <!-- Placeholder for the navigation bar -->

    <div class="container">
        <!-- Left Column: Inventory Items -->
        <div class="left-column">
            <div class="inventory-header">
                <h2>Inventory</h2>
                <div id="inventoryCounter">0/25</div>
            </div>
            <button class="add-item" id="addItemButton" onclick="addItem()">+ Add Item</button>
            <div id="unsortedItems"></div>
            <div class="category-divider"></div> <!-- Divider line before categories -->

            <h3>Consumables</h3>
            <div id="consumablesCategory"></div>
            <div class="category-divider"></div> <!-- Divider line between categories -->

            <h3>Weapons</h3>
            <div id="weaponsCategory"></div>
            <div class="category-divider"></div> <!-- Divider line between categories -->

            <h3>Equipment</h3>
            <div id="equipmentCategory"></div>
            <div class="category-divider"></div> <!-- Divider line between categories -->

            <h3>Crafting</h3>
            <div id="craftingCategory"></div>
            <div class="category-divider"></div> <!-- Divider line after last category -->

            <button class="revert-item" id="revertItemButton" onclick="showRevertPopup()">Revert Inventory</button>
        </div>

        <!-- Right Column: Character Icon and Gear -->
        <div class="right-column">
            <div class="person-icon">
                <div class="person-square"></div> <!-- Head -->
                <div class="person-square"></div> <!-- Body -->
                <div class="person-square"></div> <!-- Legs -->
                <div class="person-square"></div> <!-- Feet -->
            </div>
            <div class="gear-box">
                <label for="armor">Armor</label>
                <input type="text" id="armor" name="armor">
                <label for="head">Head</label>
                <input type="text" id="head" name="head">
                <label for="hands">Hands</label>
                <input type="text" id="hands" name="hands">
                <label for="feet">Feet</label>
                <input type="text" id="feet" name="feet">
            </div>
        </div>
    </div>

    <!-- Tooltip Element -->
    <div id="tooltip" class="tooltip"></div>

    <!-- Unlock Inventory Popup -->
    <div class="popup-overlay" id="unlockPopup">
        <div class="popup">
            <p id="unlockMessage">Inventory Full. Upgrade inventory capacity by acquiring the Pack Mule skill.</p>
            <div class="action-buttons">
                <button class="close-button" onclick="closePopup('unlockPopup')">Close</button>
                <button class="save-button" onclick="handleUnlockInventory()">I have acquired the skill</button>
            </div>
        </div>
    </div>

    <!-- Revert Inventory Popup -->
    <div class="popup-overlay" id="revertPopup">
        <div class="popup">
            <p id="revertMessage">Revert inventory capacity to previous tier?</p>
            <div class="action-buttons">
                <button class="close-button" onclick="closePopup('revertPopup')">Close</button>
                <button class="revert-button" onclick="revertInventory()">Revert</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Popup -->
    <div class="popup-overlay" id="deleteConfirmation">
        <div class="popup delete-confirmation">
            <p id="deleteConfirmationText">Are you sure you want to delete this item?</p>
            <button class="confirm-button" onclick="deleteItem()">Confirm</button>
            <button class="cancel-button" onclick="closePopup('deleteConfirmation')">Cancel</button>
        </div>
    </div>

    <!-- Info Popup -->
    <div class="popup-overlay" id="infoPopup">
        <div class="popup">
            <div class="popup-header">
                <div class="image-container">
                    <img src="https://via.placeholder.com/100" alt="Item Image" id="itemImage">
                    <input type="file" id="uploadImage" style="display: none;">
                </div>
                <div class="details">
                    <label for="popupItemName">Name</label>
                    <input type="text" id="popupItemName" placeholder="Item Name">
                    <label for="popupItemType">Type</label>
                    <select id="popupItemType">
                        <option value="Consumable">Consumable</option>
                        <option value="Weapon">Weapon</option>
                        <option value="Equipment">Equipment</option>
                        <option value="Crafting">Crafting</option>
                    </select>
                    <div class="side-by-side">
                        <div class="value-container">
                            <label for="popupItemValue">Value</label>
                            <input type="number" id="popupItemValue" placeholder="Value" oninput="updateValueSubscript()">
                            <span id="ugcSubscript"></span>
                        </div>
                        <div class="quantity-container">
                            <label for="popupItemQuantity">Quantity</label>
                            <input type="number" id="popupItemQuantity" placeholder="Quantity">
                        </div>
                    </div>
                </div>
            </div>
            <label for="popupItemDescription">Description</label>
            <textarea id="popupItemDescription" class="description" placeholder="Description"></textarea>
            <div class="action-buttons">
                <button class="save-button" onclick="saveItem()">Save</button>
                <button class="close-button" onclick="closePopup('infoPopup')">Close</button>
            </div>
        </div>
    </div>

    <script>
        let inventoryLimit = 25; // Starting inventory limit
        let currentInventoryCount = 0;
        let currentItemEditing = null; // Track which item is being edited

        function updateInventoryCounter() {
            document.getElementById('inventoryCounter').textContent = `${currentInventoryCount}/${inventoryLimit}`;
            const addItemButton = document.getElementById('addItemButton');
            const unlockButton = document.getElementById('unlockButton');
            
            if (currentInventoryCount >= inventoryLimit) {
                showUnlockButton();
            } else {
                addItemButton.style.display = 'block';
                unlockButton.style.display = 'none';
            }
        }

        function addItem() {
            if (currentInventoryCount >= inventoryLimit) {
                showUnlockButton(); // Show the unlock button when the limit is reached
                return;
            }

            const inventoryList = document.getElementById('unsortedItems');
            const newItem = document.createElement('div');
            newItem.classList.add('inventory-item');
            newItem.innerHTML = `
                <input type="number" name="itemQuantity" value="1" placeholder="Quantity" onmouseover="showTooltip(this, 'Quantity')" onmouseleave="hideTooltip()">
                <input type="text" name="itemName" placeholder="Item Name" onmouseover="showTooltip(this, 'Item Name')" onmouseleave="hideTooltip()">
                <select name="itemType" onchange="sortItem(this)" onmouseover="showTooltip(this, 'Item Type')" onmouseleave="hideTooltip()">
                    <option value="" disabled selected>Select Type</option>
                    <option value="Consumable">Consumable</option>
                    <option value="Weapon">Weapon</option>
                    <option value="Equipment">Equipment</option>
                    <option value="Crafting">Crafting</option>
                </select>
                <input type="number" name="itemValue" placeholder="Value" onmouseover="showTooltip(this, 'Value')" onmouseleave="hideTooltip()">
                <button class="info-button" onclick="showInfoPopup(this)">Info</button>
                <button class="delete-button" onclick="showDeleteConfirmation(this)">🗑️</button>
            `;
            inventoryList.appendChild(newItem);

            currentInventoryCount++;
            updateInventoryCounter();

            if (currentInventoryCount >= inventoryLimit) {
                showUnlockButton();
            }
        }

        function sortItem(selectElement) {
            const item = selectElement.closest('.inventory-item');
            const itemType = selectElement.value;
            let categoryContainer;

            switch (itemType) {
                case 'Consumable':
                    categoryContainer = document.getElementById('consumablesCategory');
                    break;
                case 'Weapon':
                    categoryContainer = document.getElementById('weaponsCategory');
                    break;
                case 'Equipment':
                    categoryContainer = document.getElementById('equipmentCategory');
                    break;
                case 'Crafting':
                    categoryContainer = document.getElementById('craftingCategory');
                    break;
                default:
                    categoryContainer = document.getElementById('unsortedItems');
            }

            categoryContainer.appendChild(item);
        }

        function showUnlockButton() {
            const addItemButton = document.getElementById('addItemButton');
            const unlockButton = document.getElementById('unlockButton');
            
            addItemButton.style.display = 'none'; // Hide the add item button
            unlockButton.style.display = 'block'; // Show the unlock button
        }

        function showUnlockPopup() {
            const unlockPopup = document.getElementById('unlockPopup');
            unlockPopup.style.display = 'flex';
        }

        function handleUnlockInventory() {
            inventoryLimit += 25; // Increase the inventory limit by 25 slots
            updateInventoryCounter();
            closePopup('unlockPopup');

            const addItemButton = document.getElementById('addItemButton');
            const unlockButton = document.getElementById('unlockButton');

            if (currentInventoryCount < inventoryLimit) {
                addItemButton.style.display = 'block'; // Show the add item button again
                unlockButton.style.display = 'none'; // Hide the unlock button
            }

            if (inventoryLimit > 25) {
                document.getElementById('revertItemButton').style.display = 'block'; // Show the revert button if upgraded
            }

            // Update the popup message for the next tier
            const packMuleLevel = inventoryLimit / 25;
            const nextPackMuleLevel = packMuleLevel + 1;
            const unlockMessage = document.getElementById('unlockMessage');
            unlockMessage.textContent = `Inventory Full. Upgrade inventory capacity by acquiring the Pack Mule ${nextPackMuleLevel === 2 ? 'II' : nextPackMuleLevel === 3 ? 'III' : nextPackMuleLevel === 4 ? 'IV' : ''} skill.`;
        }

        function saveItem() {
            if (currentItemEditing) {
                const itemName = document.getElementById('popupItemName').value;
                const itemType = document.getElementById('popupItemType').value;
                const itemValue = document.getElementById('popupItemValue').value;
                const itemQuantity = document.getElementById('popupItemQuantity').value;

                currentItemEditing.querySelector('input[name="itemName"]').value = itemName;
                currentItemEditing.querySelector('select[name="itemType"]').value = itemType;
                currentItemEditing.querySelector('input[name="itemValue"]').value = itemValue;
                currentItemEditing.querySelector('input[name="itemQuantity"]').value = itemQuantity;

                sortItem(currentItemEditing.querySelector('select[name="itemType"]')); // Ensure item is sorted correctly

                closePopup('infoPopup');
            }
        }

        let itemToDelete = null;

        function showDeleteConfirmation(button) {
            itemToDelete = button.closest('.inventory-item'); // Update reference to closest .inventory-item
            const itemName = itemToDelete.querySelector('input[name="itemName"]').value;

            const deleteConfirmationText = document.getElementById('deleteConfirmationText');
            deleteConfirmationText.textContent = `Are you sure you want to delete ${itemName}?`;

            const deleteConfirmation = document.getElementById('deleteConfirmation');
            deleteConfirmation.style.display = 'flex';
        }

        function deleteItem() {
            if (itemToDelete) {
                itemToDelete.remove();
                currentInventoryCount--;
                updateInventoryCounter();
                closePopup('deleteConfirmation');
            }
        }

        function showInfoPopup(button) {
            const item = button.closest('.inventory-item');
            const itemName = item.querySelector('input[name="itemName"]').value;
            const itemType = item.querySelector('select[name="itemType"]').value;
            const itemValue = item.querySelector('input[name="itemValue"]').value;
            const itemQuantity = item.querySelector('input[name="itemQuantity"]').value;

            currentItemEditing = item;

            document.getElementById('popupItemName').value = itemName;
            document.getElementById('popupItemType').value = itemType;
            document.getElementById('popupItemValue').value = itemValue;
            document.getElementById('popupItemQuantity').value = itemQuantity;

            const infoPopup = document.getElementById('infoPopup');
            infoPopup.style.display = 'flex';

            // Handle image click for upload
            document.getElementById('itemImage').addEventListener('click', function () {
                document.getElementById('uploadImage').click();
            });

            // Handle image upload
            document.getElementById('uploadImage').addEventListener('change', function () {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        document.getElementById('itemImage').src = e.target.result;
                        document.getElementById('itemImage').classList.add('uploaded');
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function closePopup(popupId) {
            const popup = document.getElementById(popupId);
            popup.style.display = 'none';
        }

        function showRevertPopup() {
            if (inventoryLimit > 25) {
                document.getElementById('revertPopup').style.display = 'flex';
            }
        }

        function revertInventory() {
            if (currentInventoryCount > inventoryLimit - 25) {
                alert(`You must reduce inventory count to ${inventoryLimit - 25} before reverting back a tier.`);
                return;
            }

            inventoryLimit -= 25; // Decrease the inventory limit by 25 slots
            updateInventoryCounter();
            closePopup('revertPopup');

            if (inventoryLimit <= 25) {
                document.getElementById('revertItemButton').style.display = 'none'; // Hide the revert button if back to starting limit
            }

            // Update the popup message for the previous tier
            const packMuleLevel = inventoryLimit / 25;
            const unlockMessage = document.getElementById('unlockMessage');
            unlockMessage.textContent = `Inventory Full. Upgrade inventory capacity by acquiring the Pack Mule ${packMuleLevel === 2 ? 'II' : packMuleLevel === 3 ? 'III' : packMuleLevel === 4 ? 'IV' : ''} skill.`;
        }

        function showTooltip(element, text) {
            const tooltip = document.getElementById('tooltip');
            tooltip.textContent = text;

            const rect = element.getBoundingClientRect();
            tooltip.style.left = `${rect.left + window.pageXOffset}px`;
            tooltip.style.top = `${rect.top + window.pageYOffset - 30}px`;

            tooltip.style.opacity = 1;
        }

        function hideTooltip() {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.opacity = 0;
        }

        // Load the navigation bar
        fetch('nav.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('navbar').innerHTML = data;
            });
    </script>
</body>
</html>
