<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcanex Character Sheet</title>
    <link rel="stylesheet" href="styles.css"> <!-- Link to the shared CSS file -->
</head>
<body>
    <div id="navbar"></div> <!-- Placeholder for the navbar -->

    <div class="content-wrapper">
        <div class="main-container">
            <!-- Top Row: Character Image and Title Box -->
            <div class="top-row">
                <div class="character-image">
                    <input type="file" id="uploadImage" accept="image/*">
                    <img id="characterImg" class="show" alt="">
                </div>
                <div class="title-box">
                    <div class="info-container">
                        <div class="info-box">
                            <label for="characterName">Name:</label>
                            <input type="text" id="characterName" name="characterName">
                        </div>
                        <div class="info-box">
                            <label for="characterSpecies">Species:</label>
                            <input type="text" id="characterSpecies" name="characterSpecies">
                        </div>
                        <div class="info-box">
                            <label for="characterBackground">Background:</label>
                            <input type="text" id="characterBackground" name="characterBackground">
                        </div>
                    </div>
                    <div class="info-container">
                        <div class="info-box">
                            <label for="characterLevel">Level:</label>
                            <input type="text" id="characterLevel" name="characterLevel">
                        </div>
                        <div class="info-box">
                            <label for="characterTBD">TBD:</label>
                            <input type="text" id="characterTBD" name="characterTBD">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Second Row: Attribute Points -->
            <div class="attribute-row">
                <div class="attribute">
                    <div class="title">Strength</div>
                    <div class="input-row">
                        <div>
                            <label for="strengthBase">Base</label>
                            <input type="number" id="strengthBase" name="strengthBase" oninput="updateTotal('strength')">
                        </div>
                        <div>
                            <label for="strengthBonus">Bonus</label>
                            <input type="number" id="strengthBonus" name="strengthBonus" oninput="updateTotal('strength')">
                        </div>
                    </div>
                    <div class="total-label">Total</div>
                    <div id="strengthTotal" class="total">0</div>
                </div>
                <div class="attribute">
                    <div class="title">Agility</div>
                    <div class="input-row">
                        <div>
                            <label for="agilityBase">Base</label>
                            <input type="number" id="agilityBase" name="agilityBase" oninput="updateTotal('agility')">
                        </div>
                        <div>
                            <label for="agilityBonus">Bonus</label>
                            <input type="number" id="agilityBonus" name="agilityBonus" oninput="updateTotal('agility')">
                        </div>
                    </div>
                    <div class="total-label">Total</div>
                    <div id="agilityTotal" class="total">0</div>
                </div>
                <div class="attribute">
                    <div class="title">Perception</div>
                    <div class="input-row">
                        <div>
                            <label for="perceptionBase">Base</label>
                            <input type="number" id="perceptionBase" name="perceptionBase" oninput="updateTotal('perception')">
                        </div>
                        <div>
                            <label for="perceptionBonus">Bonus</label>
                            <input type="number" id="perceptionBonus" name="perceptionBonus" oninput="updateTotal('perception')">
                        </div>
                    </div>
                    <div class="total-label">Total</div>
                    <div id="perceptionTotal" class="total">0</div>
                </div>
                <div class="attribute">
                    <div class="title">Intelligence</div>
                    <div class="input-row">
                        <div>
                            <label for="intelligenceBase">Base</label>
                            <input type="number" id="intelligenceBase" name="intelligenceBase" oninput="updateTotal('intelligence')">
                        </div>
                        <div>
                            <label for="intelligenceBonus">Bonus</label>
                            <input type="number" id="intelligenceBonus" name="intelligenceBonus" oninput="updateTotal('intelligence')">
                        </div>
                    </div>
                    <div class="total-label">Total</div>
                    <div id="intelligenceTotal" class="total">0</div>
                </div>
                <div class="attribute">
                    <div class="title">Charisma</div>
                    <div class="input-row">
                        <div>
                            <label for="charismaBase">Base</label>
                            <input type="number" id="charismaBase" name="charismaBase" oninput="updateTotal('charisma')">
                        </div>
                        <div>
                            <label for="charismaBonus">Bonus</label>
                            <input type="number" id="charismaBonus" name="charismaBonus" oninput="updateTotal('charisma')">
                        </div>
                    </div>
                    <div class="total-label">Total</div>
                    <div id="charismaTotal" class="total">0</div>
                </div>
                <div class="attribute">
                    <div class="title">Arcana</div>
                    <div class="input-row">
                        <div>
                            <label for="arcanaBase">Base</label>
                            <input type="number" id="arcanaBase" name="arcanaBase" oninput="updateTotal('arcana')">
                        </div>
                        <div>
                            <label for="arcanaBonus">Bonus</label>
                            <input type="number" id="arcanaBonus" name="arcanaBonus" oninput="updateTotal('arcana')">
                        </div>
                    </div>
                    <div class="total-label">Total</div>
                    <div id="arcanaTotal" class="total">0</div>
                </div>
                <div class="attribute">
                    <div class="title">Spirituality</div>
                    <div class="input-row">
                        <div>
                            <label for="spiritualityBase">Base</label>
                            <input type="number" id="spiritualityBase" name="spiritualityBase" oninput="updateTotal('spirituality')">
                        </div>
                        <div>
                            <label for="spiritualityBonus">Bonus</label>
                            <input type="number" id="spiritualityBonus" name="spiritualityBonus" oninput="updateTotal('spirituality')">
                        </div>
                    </div>
                    <div class="total-label">Total</div>
                    <div id="spiritualityTotal" class="total">0</div>
                </div>
            </div>

            <!-- Third Row: Stat Points -->
            <div class="stat-row">
                <div class="stat-box">
                    <label for="healthPoints">Health Points</label>
                    <div class="arrows">
                        <div class="arrow" onclick="incrementValue('healthPoints', -1)">&#9664;</div>
                        <input type="number" id="healthPoints" name="healthPoints" value="0">
                        <div class="arrow" onclick="incrementValue('healthPoints', 1)">&#9654;</div>
                    </div>
                </div>
                <div class="stat-box">
                    <label for="actionPoints">Action Points</label>
                    <div class="arrows">
                        <div class="arrow" onclick="incrementValue('actionPoints', -1)">&#9664;</div>
                        <input type="number" id="actionPoints" name="actionPoints" value="0">
                        <div class="arrow" onclick="incrementValue('actionPoints', 1)">&#9654;</div>
                    </div>
                </div>
                <div class="stat-box">
                    <label for="manaPoints">Mana Points</label>
                    <div class="arrows">
                        <div class="arrow" onclick="incrementValue('manaPoints', -1)">&#9664;</div>
                        <input type="number" id="manaPoints" name="manaPoints" value="0">
                        <div class="arrow" onclick="incrementValue('manaPoints', 1)">&#9654;</div>
                    </div>
                </div>
                <div class="stat-box">
                    <label for="shieldCapacity">Shield Capacity</label>
                    <div class="arrows">
                        <div class="arrow" onclick="incrementValue('shieldCapacity', -1)">&#9664;</div>
                        <input type="number" id="shieldCapacity" name="shieldCapacity" value="0">
                        <div class="arrow" onclick="incrementValue('shieldCapacity', 1)">&#9654;</div>
                    </div>
                </div>
            </div>

            <!-- Fourth Row: Inspiration Points and Dice -->
            <div class="inspiration-row">
                <div class="inspiration-box">
                    <label>Inspiration Points</label>
                    <div class="inspiration-points-container">
                        <div class="arrow" onclick="incrementInspirationPoints(-1)">&#9664;</div>
                        <div class="inspiration-points">
                            <div class="inspiration-point"></div>
                            <div class="inspiration-point"></div>
                            <div class="inspiration-point"></div>
                            <div class="inspiration-point"></div>
                            <div class="inspiration-point"></div>
                            <div class="inspiration-point"></div>
                            <div class="inspiration-point"></div>
                            <div class="inspiration-point"></div>
                            <div class="inspiration-point"></div>
                            <div class="inspiration-point"></div>
                        </div>
                        <div class="arrow" onclick="incrementInspirationPoints(1)">&#9654;</div>
                    </div>
                </div>
                <div class="inspiration-dice">
                    <label for="inspirationDice">Inspiration Dice</label>
                    <input type="number" id="inspirationDice" name="inspirationDice" value="0" style="text-align: center;">
                </div>
            </div>
        </div>
        <div id="chatbox"></div> <!-- Placeholder for the chatbox -->
    </div>

    <div class="popup" id="popup">
        <p>You have gained an Inspiration Dice!</p>
        <button onclick="closePopup()">Close</button>
    </div>

    <script>
        document.getElementById("uploadImage").addEventListener("change", function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById("characterImg");
                    img.src = e.target.result;
                    img.classList.add("show");
                };
                reader.readAsDataURL(file);
            }
        });

        function updateTotal(attribute) {
            const base = parseInt(document.getElementById(attribute + "Base").value) || 0;
            const bonus = parseInt(document.getElementById(attribute + "Bonus").value) || 0;
            const total = base + bonus;
            document.getElementById(attribute + "Total").textContent = total;
        }

        function incrementValue(id, amount) {
            const input = document.getElementById(id);
            let value = parseInt(input.value) || 0;
            value += amount;
            if (value < 0) value = 0; // Prevent negative values
            input.value = value;
        }

        function incrementInspirationPoints(amount) {
            const points = document.querySelectorAll('.inspiration-point');
            let currentCount = Array.from(points).filter(point => point.classList.contains('checked')).length;
            let newCount = currentCount + amount;

            if (newCount > 10) newCount = 10;
            if (newCount < 0) newCount = 0;

            points.forEach((point, index) => {
                if (index < newCount) {
                    point.classList.add('checked');
                } else {
                    point.classList.remove('checked');
                }
            });

            if (newCount === 10) {
                incrementValue('inspirationDice', 1);
                resetInspirationPoints();
                showPopup();
                sendInspirationDiceMessage();
            }
        }

        function resetInspirationPoints() {
            const points = document.querySelectorAll('.inspiration-point');
            points.forEach(point => point.classList.remove('checked'));
        }

        function showPopup() {
            const popup = document.getElementById('popup');
            popup.style.display = 'block';
        }

        function closePopup() {
            const popup = document.getElementById('popup');
            popup.style.display = 'none';
        }

        function sendInspirationDiceMessage() {
            const characterName = document.getElementById('characterName').value || "A player";
            const chatboxContent = document.getElementById('chatboxMessages');
            if (chatboxContent) {
                const timestamp = new Date().toLocaleTimeString();
                const messageElement = document.createElement('div');
                messageElement.classList.add('chat-message');

                messageElement.innerHTML = `
                    <div class="message-header">${characterName} @ ${timestamp}</div>
                    <div class="message-body">${characterName} has gained an Inspiration Dice!</div>
                `;
                chatboxContent.appendChild(messageElement);
                chatboxContent.scrollTop = chatboxContent.scrollHeight;
            }
        }

        // Load the navigation bar
        fetch('nav.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('navbar').innerHTML = data;
            });

        // Load the chatbox
        fetch('chatbox.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('chatbox').innerHTML = data;

                // Re-initialize chatbox-related scripts
                const script = document.createElement('script');
                script.textContent = `
                    function sendMessage() {
                        const messageInput = document.getElementById('chatMessage');
                        const messageText = messageInput.value.trim();

                        if (messageText) {
                            const messageContainer = document.createElement('div');
                            messageContainer.textContent = messageText;
                            document.getElementById('chatboxMessages').appendChild(messageContainer);
                            messageInput.value = '';
                            messageInput.focus();
                        }
                    }
                `;
                document.body.appendChild(script);
            });
    </script>
</body>
</html>
